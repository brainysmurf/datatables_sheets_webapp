<script>

$(function () {

	var setbtnDisabled = function($btn, bool) {
		$btn.button('option', 'disabled', bool);
		return $btn;
	};

	$("#timer").TimeCircles({
		start: false,
		time: {
			Days: { show: false },
			Hours: { show: false },
			Seconds: { show: true },
		}
	});

	var $startButton = $('#buttonStart'),
		$finishedButton = $('#buttonFinished'),
		$resetButton = $('#buttonReset'),
		$timer = $('#timer');

	$startButton.button();
	$finishedButton.button({
		disabled: true,
	});
	$resetButton.button({
		disabled: true,
	});

	$('#tabs').tabs();

	$( "#emails" ).autocomplete({
	  source: $('#emailContainer').data('contacts')
	});

	$startButton.click(function () {

		// 
		// Interact with the document: START button clicked
		//
		if ($(this).text() == 'Start') {

			google.script.run
					.withSuccessHandler(function () {
						$timer.TimeCircles().start();
						$(this).text('Pause');
						$(this).removeClass('pausedButton');
						$(this).removeClass('startButton');
						setbtnDisabled($finishedButton, false);
						google.script.host.editor.focus();
					}.bind(this))
					.withFailureHandler(function (error) {
						console.log(error);
					})
				.start();  // interact with document with Google API calls

		} else if ($(this).text() == 'Resume') {
			$timer.TimeCircles().start();
			$(this).text('Pause');
			$(this).removeClass('pausedButton');
			$(this).removeClass('startButton');
		} else {
			$timer.TimeCircles().stop();
			$(this).text('Resume');
			$(this).addClass('pausedButton')
		}
	});

	$finishedButton.click(function (e) {
		if (this.disabled) { e.preventDefault(); return; }
		var duration = parseInt($timer.data('timer')) - $timer.TimeCircles().getTime();
		google.script.run
				.withSuccessHandler(function () {
					setbtnDisabled($finishedButton, true);
					setbtnDisabled($resetButton, false)
						.click();
				})
				.withFailureHandler(function (error) {
					setbtnDisabled($resetButton, false).click();
				})
			.finish(duration);
	});

	$resetButton.click(function (e) {
		if (this.disabled) { e.preventDefault(); return; }
		$timer.TimeCircles().restart();
		$timer.TimeCircles().stop();
		$startButton.text('Start');
		setbtnDisabled($(this), true);
		setbtnDisabled($finishedButton, true);
		$startButton.removeClass('pausedButton');
		$startButton.addClass('startButton');
	})

});

</script>