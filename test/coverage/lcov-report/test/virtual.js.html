<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for test/virtual.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">test/</a> virtual.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">31.43% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>11/35</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">32.35% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>11/34</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
	Interfaces with gas-local in order to bring what is normally server-side code
	into the local node.js stack, i.e. "virtualizing" it
&nbsp;
	Creates an object virtual that contains all code in source folders
	Also has method .virtual which creates one as well, which is used to pass on
	virtualized code into templating files
*/
&nbsp;
'use strict';
&nbsp;
let moment = require('moment');
let gas = require('gas-local');
let ejs = require('ejs');
let sinon = require('sinon');
let Document = require('./Document.js');
const sourcePath = 'dev';
&nbsp;
var googleRunScript = {
	successHandlers: [],
	failureHandlers: [],
	userObject: {},
	withSuccessHandler: <span class="fstat-no" title="function not covered" >function(func) {</span>
<span class="cstat-no" title="statement not covered" >		this.successHandlers.push(func);</span>
<span class="cstat-no" title="statement not covered" >		return this;</span>
	},
	withFailureHandler: <span class="fstat-no" title="function not covered" >function(func) {</span>
<span class="cstat-no" title="statement not covered" >		this.failureHandlers.push(func);</span>
<span class="cstat-no" title="statement not covered" >		return this;</span>
	},
	withUserObject: <span class="fstat-no" title="function not covered" >function(obj) {</span>
<span class="cstat-no" title="statement not covered" >		this.userObject = obj;</span>
<span class="cstat-no" title="statement not covered" >		return this;</span>
	},
};
&nbsp;
var getter = {
&nbsp;
	/*
		Get function allows us to add a __noSuchMethod__ feature onto
		googleRunScript above
&nbsp;
		Limitations, because we are returning a promise, we cannot call it
	*/
	get: <span class="fstat-no" title="function not covered" >function(target, name) {</span>
&nbsp;
		// If already defined, i.e. with.. method, use that...
<span class="cstat-no" title="statement not covered" >		if (name in target) {</span>
<span class="cstat-no" title="statement not covered" >			return target[name];</span>
&nbsp;
		// otherwise this is something that needs to be emulated...
		} else {
			// just returning virtual[name] will not allow us to call handlers
			// so let's return a promise
&nbsp;
<span class="cstat-no" title="statement not covered" >			var promise = new Promise(</span>
<span class="fstat-no" title="function not covered" >				function (resolve, reject) {</span>
<span class="cstat-no" title="statement not covered" >					try {</span>
<span class="cstat-no" title="statement not covered" >						var result = virtual[name](/* the arg would go here */);</span>
<span class="cstat-no" title="statement not covered" >						resolve(result);</span>
					} catch(err) {
<span class="cstat-no" title="statement not covered" >						reject(err)</span>
					}
				}
			);
<span class="cstat-no" title="statement not covered" >			promise.then(</span>
<span class="fstat-no" title="function not covered" >				function (args) {</span>
<span class="cstat-no" title="statement not covered" >					target.successHandlers.forEach(<span class="fstat-no" title="function not covered" >function (func) {</span></span>
						// call the success handlers
<span class="cstat-no" title="statement not covered" >						func(args, target.userObject);</span>
					});
				}
			).catch(
<span class="fstat-no" title="function not covered" >				function (args) {</span>
<span class="cstat-no" title="statement not covered" >					target.failureHandlers.forEach(<span class="fstat-no" title="function not covered" >function (func) {</span></span>
<span class="cstat-no" title="statement not covered" >						func(args, target.userObject);</span>
					});
				}
			);
&nbsp;
			// Need to wrap in a function in order for it to be called
			// This means we canNOT use argument to call anything...
<span class="cstat-no" title="statement not covered" >			return <span class="fstat-no" title="function not covered" >function () {</span> <span class="cstat-no" title="statement not covered" >promise }</span>;</span>
		}
&nbsp;
	}
};
&nbsp;
&nbsp;
let MockedObjects = {
	google: {
		script: {
			run: new Proxy(googleRunScript, getter)
		}
	},
	production: false,
&nbsp;
	DocumentApp: {
		getActiveDocument: <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >			return new Document();</span>
		},
&nbsp;
		/* constants */
		ElementType: {
			HORIZONTAL_RULE: '&lt;hr&gt;',
		}
	},
&nbsp;
	Moment: moment,
	__proto__: gas.globalMockDefault,
};
MockedObjects.Moment.load = <span class="fstat-no" title="function not covered" >function () {</span>};  // load is part of GAS ecosystem
var virtual = gas.require('./' + sourcePath, MockedObjects);
&nbsp;
// Passed into include in order to ensure templates have virtual source too
<span class="cstat-no" title="statement not covered" >virtual.virtual = <span class="fstat-no" title="function not covered" >function () { </span></span>
<span class="cstat-no" title="statement not covered" >	gas.require('./' + sourcePath, MockedObjects);</span>
};
&nbsp;
<span class="cstat-no" title="statement not covered" >module.exports = virtual;</span></pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Mar 18 2017 21:09:01 GMT+0800 (MYT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
